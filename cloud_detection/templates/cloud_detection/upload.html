{% extends 'cloud_detection/base.html' %}

{% block title %}Upload Satellite Data - Cloud Detection Portal{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-cloud-upload-alt me-2"></i>
                    Upload Satellite Data
                </h4>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data" id="upload-form">
                    {% csrf_token %}
                    
                    <!-- File Upload Area -->
                    <div class="mb-4">
                        <label for="file-upload" class="form-label">
                            <i class="fas fa-file-upload me-2"></i>
                            Select HDF5 Satellite Data File
                        </label>
                        <div class="file-upload-area" id="file-upload-area">
                            <div class="upload-content">
                                <i class="fas fa-cloud-upload-alt text-primary mb-3" style="font-size: 4rem;"></i>
                                <h5>Drag & Drop your HDF5 file here</h5>
                                <p class="text-muted">or click to browse files</p>
                                <p class="text-muted">
                                    <small>
                                        <i class="fas fa-info-circle me-1"></i>
                                        Supported formats: .h5, .hdf5, .nc, .netcdf (Max: 500MB)
                                    </small>
                                </p>
                            </div>
                            {{ form.file_path }}
                        </div>
                        {% if form.file_path.errors %}
                            <div class="text-danger mt-2">
                                {% for error in form.file_path.errors %}
                                    <small><i class="fas fa-exclamation-triangle me-1"></i>{{ error }}</small>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- File Info Display -->
                    <div id="file-info" class="mb-4" style="display: none;">
                        <div class="alert alert-info">
                            <h6><i class="fas fa-file me-2"></i>Selected File:</h6>
                            <div id="file-details"></div>
                        </div>
                    </div>
                    
                    <!-- Satellite Information -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <label for="{{ form.satellite_name.id_for_label }}" class="form-label">
                                <i class="fas fa-satellite me-2"></i>
                                Satellite Name
                            </label>
                            {{ form.satellite_name }}
                            {% if form.satellite_name.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.satellite_name.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6">
                            <label for="{{ form.data_type.id_for_label }}" class="form-label">
                                <i class="fas fa-database me-2"></i>
                                Data Type
                            </label>
                            {{ form.data_type }}
                            {% if form.data_type.errors %}
                                <div class="text-danger mt-1">
                                    {% for error in form.data_type.errors %}
                                        <small>{{ error }}</small>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Upload Progress -->
                    <div id="upload-progress" class="mb-4" style="display: none;">
                        <div class="progress mb-2">
                            <div class="progress-bar" role="progressbar" style="width: 0%" id="progress-bar">
                                0%
                            </div>
                        </div>
                        <div class="text-center">
                            <small class="text-muted">Uploading file...</small>
                        </div>
                    </div>
                    
                    <!-- Submit Button -->
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg me-3" id="upload-btn">
                            <i class="fas fa-upload me-2"></i>
                            Upload & Process
                        </button>
                        <a href="{% url 'home' %}" class="btn btn-secondary btn-lg">
                            <i class="fas fa-times me-2"></i>
                            Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Upload Guidelines -->
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Upload Guidelines
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6><i class="fas fa-check-circle text-success me-2"></i>Supported Formats</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-file me-2 text-muted"></i>.h5 (HDF5)</li>
                            <li><i class="fas fa-file me-2 text-muted"></i>.hdf5 (HDF5)</li>
                            <li><i class="fas fa-file me-2 text-muted"></i>.nc (NetCDF)</li>
                            <li><i class="fas fa-file me-2 text-muted"></i>.netcdf (NetCDF)</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6><i class="fas fa-ruler me-2 text-warning"></i>File Requirements</h6>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-weight me-2 text-muted"></i>Maximum size: 500MB</li>
                            <li><i class="fas fa-satellite me-2 text-muted"></i>INSAT data preferred</li>
                            <li><i class="fas fa-thermometer-half me-2 text-muted"></i>Must contain temperature data</li>
                            <li><i class="fas fa-clock me-2 text-muted"></i>Half-hourly observations</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .file-upload-area {
        position: relative;
        border: 2px dashed var(--accent-color);
        border-radius: 15px;
        padding: 3rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        background: rgba(74, 144, 226, 0.05);
    }
    
    .file-upload-area:hover {
        border-color: var(--cloud-blue);
        background: rgba(74, 144, 226, 0.1);
        transform: translateY(-2px);
    }
    
    .file-upload-area.dragover {
        border-color: var(--success-color);
        background: rgba(16, 185, 129, 0.1);
        transform: scale(1.02);
    }
    
    .file-upload-area.file-selected {
        border-color: var(--success-color);
        background: rgba(16, 185, 129, 0.05);
    }
    
    .file-upload-area input[type="file"] {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }
    
    .upload-content {
        pointer-events: none;
    }
    
    .upload-content i {
        transition: all 0.3s ease;
    }
    
    .file-upload-area:hover .upload-content i {
        transform: scale(1.1);
        color: var(--cloud-blue) !important;
    }
    
    .file-upload-area.dragover .upload-content i {
        transform: scale(1.2);
        color: var(--success-color) !important;
    }
    
    .progress {
        height: 30px;
        background: var(--accent-bg);
        border-radius: 15px;
        overflow: hidden;
    }
    
    .progress-bar {
        background: linear-gradient(90deg, var(--accent-color), var(--success-color));
        transition: width 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
    }
    
    .btn-lg {
        padding: 12px 30px;
        font-size: 1.1rem;
        border-radius: 25px;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 600;
    }
    
    .card {
        border-radius: 15px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }
    
    .alert-info {
        background: rgba(74, 144, 226, 0.1);
        border-left: 4px solid var(--accent-color);
        color: var(--text-primary);
    }
    
    .list-unstyled li {
        padding: 5px 0;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const fileUploadArea = document.getElementById('file-upload-area');
    const fileInput = document.getElementById('file-upload');
    const fileInfo = document.getElementById('file-info');
    const fileDetails = document.getElementById('file-details');
    const uploadForm = document.getElementById('upload-form');
    const uploadProgress = document.getElementById('upload-progress');
    const progressBar = document.getElementById('progress-bar');
    const uploadBtn = document.getElementById('upload-btn');
    
    // Drag and drop functionality
    fileUploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        fileUploadArea.classList.add('dragover');
    });
    
    fileUploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
    });
    
    fileUploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            displayFileInfo(files[0]);
        }
    });
    
    // File input change
    fileInput.addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            displayFileInfo(e.target.files[0]);
        }
    });
    
    // Display file information
    function displayFileInfo(file) {
        const fileSize = (file.size / (1024 * 1024)).toFixed(2);
        const fileName = file.name;
        const fileType = file.type || 'Unknown';
        
        fileDetails.innerHTML = `
            <div class="row">
                <div class="col-md-6">
                    <strong>Name:</strong> ${fileName}<br>
                    <strong>Size:</strong> ${fileSize} MB
                </div>
                <div class="col-md-6">
                    <strong>Type:</strong> ${fileType}<br>
                    <strong>Status:</strong> <span class="text-success">Ready to upload</span>
                </div>
            </div>
        `;
        
        fileInfo.style.display = 'block';
        fileUploadArea.classList.add('file-selected');
        
        // Update upload area content
        fileUploadArea.querySelector('.upload-content').innerHTML = `
            <i class="fas fa-check-circle text-success mb-3" style="font-size: 4rem;"></i>
            <h5 class="text-success">File Selected</h5>
            <p class="text-muted">${fileName}</p>
            <p class="text-muted">
                <small>
                    <i class="fas fa-info-circle me-1"></i>
                    Click to change file
                </small>
            </p>
        `;
    }
    
    // Form submission with progress
    uploadForm.addEventListener('submit', function(e) {
        if (fileInput.files.length === 0) {
            e.preventDefault();
            alert('Please select a file to upload.');
            return;
        }
        
        // Show progress bar
        uploadProgress.style.display = 'block';
        uploadBtn.disabled = true;
        uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Uploading...';
        
        // Simulate progress (in real implementation, use XMLHttpRequest for real progress)
        let progress = 0;
        const interval = setInterval(function() {
            progress += Math.random() * 15;
            if (progress > 95) {
                progress = 95;
                clearInterval(interval);
            }
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';
        }, 200);
    });
    
    // File type validation
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const validExtensions = ['.h5', '.hdf5', '.nc', '.netcdf'];
            const fileName = file.name.toLowerCase();
            const isValidExtension = validExtensions.some(ext => fileName.endsWith(ext));
            
            if (!isValidExtension) {
                alert('Please select a valid file format (.h5, .hdf5, .nc, .netcdf)');
                e.target.value = '';
                fileInfo.style.display = 'none';
                fileUploadArea.classList.remove('file-selected');
                return;
            }
            
            if (file.size > 500 * 1024 * 1024) { // 500MB
                alert('File size must be less than 500MB');
                e.target.value = '';
                fileInfo.style.display = 'none';
                fileUploadArea.classList.remove('file-selected');
                return;
            }
        }
    });
});
</script>
{% endblock %} 